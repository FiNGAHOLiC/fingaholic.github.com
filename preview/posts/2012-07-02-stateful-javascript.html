<!doctype html>
<html class="no-js" lang="ja">
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width">
	<meta name="description" content="All doggs wanna be a Geek">
	<meta property="og:locale" content="ja_JP">
	<meta property="og:title" content="ステートフルJavaScript 2章 | jekylog">
	<meta property="og:type" content="website">
	<meta property="og:url" content="http://fingaholic.github.com/posts/2012-07-02-stateful-javascript.html">
	<meta property="og:image" content="http://fingaholic.github.com/img/logo1.png">
	<meta property="og:site_name" content="jekylog">
	<meta property="og:description" content="ステートフルJavaScript2章の備考録、っていうか写経。早くMVCへ行きたいけど復習も兼ねて。">
	<meta property="fb:app_id" content="414280305262678">
	<title>ステートフルJavaScript 2章 | jekylog</title>
	<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
	<link rel="alternate" href="/atom.xml" type="application/rss+xml" title="jekylog">
	<link rel="stylesheet" href="/css/all.min.css">
	<script src="/js/modernizr-2.5.3.min.js"></script>
	<script>if(!Modernizr.mq('only all')) Modernizr.load('/js/respond.min.js');</script>
	<script src="//typesquare.com/accessor/script/typesquare.js?4K0leOFaobI%3D"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/all.min.js"></script>
</head>

	<body>
		<div class="area-body">
			<header class="area-header">
	<div class="mod-header">
		<hgroup>
			<h1><a href="/">jekylog</a></h1>
			<h2>All doggs wanna be a Geek</h2>
		</hgroup>
	</div>
	<div class="mod-gnavi">
		<nav>
			<ul>
				<li><a href="/">Home</a></li>
				<li><a href="/archive.html">Archive</a></li>
				<li><a href="/about.html">About</a></li>
			</ul>
		</nav>
	</div>
</header>

			<div class="area-main"><article class="mod-postdetail">
	<header>
		<p><time datatime="02 Jul 2012">02 Jul 2012</time></p>
		<h1>ステートフルJavaScript 2章</h1>
	</header>
	<section class="mod-postmain"><h1 id='21_'>2.1 イベントの監視</h1>

<blockquote>
<p>イベントリスナを削除するにはremoveEventListener()を使います。ここには以下のように、addEventListenerで指定したのと同じ引数を指定します。リスナが匿名関数であるなどの理由でリスナへの参照が存在しない場合は、要素ごと破棄しない限りリスナを削除することはできません。</p>
</blockquote>

<p>まあ当たり前の事ですね。<br />ちなみに非標準だけど第4引数はaWantsUntrustedで、信頼されないコンテンツによって引き起こされるイベントを許可する、なる項目もあるらしい。</p>

<ul>
<li><a href='https://developer.mozilla.org/ja/DOM/element.addEventListener,' title='element.addEventListener - MDN'>element.addEventListener - MDN</a></li>
</ul>

<h1 id='22_'>2.2 イベントの発生順序</h1>

<p>ある要素とその祖先に同じ種類のイベントを指定している場合、下記ブラウザによって挙動が違う。</p>

<blockquote>
<p>Netscape4はイベントキャプチャリング（event capturing）に対応しています。ここでは、最も上位（外側）の要素からイベントが発生した要素へと順にイベントリスナが呼び出されていきます。</p>
</blockquote>

<p>これは分かりづらいと思う。</p>

<blockquote>
<p>一方、Microsoftが取り入れたのはイベントバブリング（event bubbling）という考え方です。ここでは、イベントが発生した要素（内側）から祖先要素へと順にイベントリスナが呼ばれます。</p>
</blockquote>

<p>バブリングの方がイメージしやすいのでaddEventListener（IEの場合はattachEvent）関数の第3引数にはfalse、または指定しないようにしておくのが一般的。</p>

<h1 id='23_'>2.3 イベント処理のキャンセル</h1>

<p>stopPropagation関数でバブリングを中止出来る。<br />preventDefault関数でデフォルトのアクションをキャンセル出来る。<br />※イベントハンドラが返り値としてfalseを返しても同様の効果がある。</p>

<h1 id='24_'>2.4 イベントオブジェクト</h1>

<p>下記参考リンク。</p>

<ul>
<li><a href='https://developer.mozilla.org/ja/DOM/event,' title='event - MDN'>event - MDN</a></li>
</ul>

<h1 id='25_'>2.5 イベントライブラリ</h1>

<p>解説ではbind関数だけどjQuery1.7からはon、またはoffの方が良いかも。</p>

<ul>
<li><a href='http://ginpen.com/2011/11/04/jquery-1-7/,' title='jQuery 1.7の更新内容をまとめたよ。 | Ginpen.com'>jQuery 1.7の更新内容をまとめたよ。 | Ginpen.com</a></li>
</ul>

<h1 id='26_'>2.6 コンテキストの変化</h1>

<p>まあ最初はよく分からんかった。</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>上記を解決するには、</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>のように$.proxyでコンテキストとして利用したいオブジェクトを使用してやるといい。</p>

<h1 id='27_'>2.7 イベントの委譲</h1>

<p><strong>子孫の要素でそれぞれイベントを設定するより祖先要素にリスナを1つ登録</strong>すればいいよねと。<br />これ割りと基本的な事だし実践的だから忘れないようにしないとなあ。余計なクラス付与しなくてもいいし。</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>上記だとli要素それぞれにリスナを登録してるけど、</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<h1 id='28_'>2.8 カスタムイベント</h1>

<p>これはよく使う。Pub/Subパターンにつながる。</p>

<h1 id='29_jquery'>2.9 カスタムイベントとjQueryプラグイン</h1>

<p>本だとちょっと？ってなる箇所もあったので付け足して実例。<br />まずは悪い例。</p>

<p>HTML</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>JavaScript</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>上記だと、</p>

<ol>
<li>すべてのli要素に対してクリックイベントのハンドラを設定している 2. イベントハンドラの処理が長い</li>
</ol>

<p>という問題があるのでこれをリファクタリングしたのが下記。<br />※HTMLは変更しない</p>

<p>JavaScript</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>大分見通しは良くなった。 これだと$(&#8216;#tabs&#8217;).trigger(&#8216;change.tabs&#8217;, &#8216;groups&#8217;)でプログラムの中からタブを切り替えたりも出来る。</p>

<h1 id='210_dom'>2.10 非DOMイベント</h1>

<p>きました。デザインパターン。</p>

<blockquote>
<p>パブリッシュ/サブスクライブはパブサブ（Pub/Sub）と呼ばれることもあり、パブリッシャーとサブスクライバーという2つの実体の間で行われるメッセージ交換をパターン化したものです。パブリッシャーは特定のチャンネルにメッセージをパブリッシュ（公開）し、そのチャンネルをサブスクライブ（購読）しているサブスクライバーは新規メッセージの公開時通知を受け取ります。ここでのポイントはパブリッシャーとサブスクライバーのプログラムが完全に分離しており、お互いの存在について関知する必要すらないという点です。</p>
</blockquote>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>上記コードをhashchangeでお馴染みのBen AlmanさんがjQueryライブラリとして公開してる。<br />※記事ではbind、unbindだけどon、offにアップデートされてた。</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<ul>
<li><a href='https://gist.github.com/661855' title='jQuery Tiny Pub/Sub: A really, really, REALLY tiny pub/sub implementation for jQuery. &amp;mdash; Gist'>jQuery Tiny Pub/Sub: A really, really, REALLY tiny pub/sub implementation for jQuery. &#8212; Gist</a></li>
</ul>

<p>使い方は下記。</p>

<p>Liquid error: No such file or directory - posix_spawnp</p>

<p>という訳でいよいよ次からMVC。</p></section>
</article>
<div class="mod-socialbutton">
	<div class="tw-like"><a href="https://twitter.com/share" class="twitter-share-button" data-via="FiNGAHOLiC" data-lang="ja">ツイート</a></div>
	<div class="fb-like" data-send="false" data-layout="button_count" data-show-faces="false" data-font="verdana"></div>
</div>


	<div class="mod-pagenation">
		
			<div class="prev"><a href="/posts/2012-06-27-stateful-javascript.html">&#171; Previous Entry</a></div>
		
		
			<div class="next"><a href="/posts/2012-07-17-stateful-javascript.html">Next Entry &#187;</a></div>
		
	</div>

</div>
			<footer class="area-footer">
	<div class="mod-footer">
		<p><small>Copyright &#xA9; 2012 fingaholic</small></p>
	</div>
</footer>

		</div>
		<script type="text/javascript">
	var _gaq = _gaq || [['_setAccount', 'UA-30944384-1'], ['_trackPageview']];
	(function(d, t){
		var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
		g.async = true;
		g.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		s.parentNode.insertBefore(g, s);
	})(document, 'script');
</script>


		<div id="fb-root"></div>
		<div class="mod-github"><a href="http://github.com/fingaholic"><img src="https://a248.e.akamai.net/camo.github.com/5d21241b64dc708fcbb701f68f72f41e9f1fadd6/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a></div>
	</body>
</html>
